<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<style>
			table{
				cursor: default;
			}
		</style>
		<script type="text/javascript" src="../js/jquery-1.11.3.js"></script>
		<script>
			$(function() {
				var myTable = $("#myTable");
				var addRows = $("#addRows");
				var addCols = $("#addCols");
				var delRows = $("#delRows");
				var delCols = $("#delCols");
				
				var selectRow = null;
				var selectCol = null;
				
				myTable.find("td").dblclick(function(){
					var myText = $(this).html();
					$(this).empty();
					var inputText = $("<input type='text' size='10'>").appendTo($(this));
					inputText.val(myText).focus().select();
				});
				
				//行点击事件
				myTable.find("tr:gt(0)").click(function(event){
					init();
					//注意：由于第一行是th，所以不算。因此selectRow从1开始
					selectRow = $(this).index();
					$(this).css("background-color","#DDD");
					event.stopPropagation();
				});
				
				//th点击事件
				myTable.find("th").click(function(event){
					init();
					selectCol = $(this).index();
					$(this).css("background-color","#DDD");
					//nth-child的n从1开始
					myTable.find("td:nth-child("+(selectCol+1)+")").css("background-color","#DDD");
					event.stopPropagation();
				});
				
				addRows.click(function(){
					//克隆一行，作为添加的新行。这样做的好处是：将事件一起克隆过来
					var rowTemplet = myTable.find("tr:last-child").clone(true);
					rowTemplet.find("td").html("&nbsp;");
				
					//如果selectRow为null，说明没有选择行，那么就追加一行，否则插入一行
					if(selectRow == null){
						myTable.append(rowTemplet);
					}else{
						myTable.find("tr:eq("+selectRow+")").before(rowTemplet);
					}
					//每次添加一行后，将所有选择等行或列都清空。
					init();
					event.stopPropagation();
				});
				
				addCols.click(function(){
					//克隆最后一个th，作为添加的新列。这样做的好处是：将事件一起克隆过来
					var thTemplet = myTable.find("th:last-child").clone(true);
					thTemplet.html("new col");
					//克隆最后一行中的最后一列td，作为添加的新列。这样做的好处是：将事件一起克隆过来
					var colTemplet = myTable.find("tr:last-child").find("td:last-child").clone(true);
					colTemplet.html("&nbsp;");
				
					if(selectCol == null){
						//在第一行追加th，其他行追加td
						myTable.find("tr:eq(0)").append(thTemplet);
						myTable.find("tr:gt(0)").append(colTemplet);
					}else{
						//在当前选择的th前插入一个th。
						myTable.find("th:eq("+selectCol+")").before(thTemplet);
						//其他行的选择的td前插入一个td
						myTable.find("tr:gt(0)").find("td:eq("+selectCol+")").before(colTemplet);
					}
					init();
					event.stopPropagation();
				});
				
				delRows.click(function(){
					if(myTable.find("tr:gt(0)").size()<=1){
						alert("已经是最后一行了，不能删除！");
						init();
						return false;
					}
					if(selectRow == null){
						alert("请选择要删除的行？");
					}else{
						myTable.find("tr:eq("+selectRow+")").remove();
					}
					init();
					event.stopPropagation();
				});
				
				delCols.click(function(){
					if(myTable.find("th").size()<=1){
						alert("已经是最后一列了，不能删除！");
						init();
						return false;
					}
					if(selectCol == null){
						alert("请选择要删除的列？");
					}else{
						myTable.find("th:eq("+selectCol+")").remove();
						myTable.find("tr:gt(0)").find("td:eq("+selectCol+")").remove();
					}
					init();
					event.stopPropagation();
				});
				
				$(document).click(function(){
					init();
					//设置单元格文字，先找到所有带文本框等td
					var tdInput = myTable.find("td").has("input");
					tdInput.each(function(){
						var inputText = $(this).find("input").val();
						$(this).empty().html(inputText);
					});
				});
				
				function init(){
					selectRow = null;
					selectCol = null;
					//因为td的优先级比tr高，如果将td背景设置为#FFF,那么再设置tr的背景就不好用了。所以这里将td等的背景设置为空，或将样式移除
					//myTable.find("th,td,tr").css("background-color","");
					myTable.find("th,td,tr").attr("style","");
				}
				
				
				
			});
		</script>
	</head>

	<body>
		<table border="1" cellspacing="0">
			<tbody id="myTable">
				<tr>
					<th>学员编号</th>
					<th>学员姓名</th>
					<th>学员性别</th>
					<th>学员年龄</th>
				</tr>
				<tr>
					<td>1</td>
					<td>习近平</td>
					<td>男</td>
					<td>60</td>
				</tr>
				<tr>
					<td>2</td>
					<td>普京</td>
					<td>男</td>
					<td>65</td>
				</tr>
				<tr>
					<td>3</td>
					<td>奥巴马</td>
					<td>男</td>
					<td>64</td>
				</tr>
			</tbody>
		</table>
		<br>
		<button id="addRows">添加行</button>
		<button id="addCols">添加列</button>
		<button id="delRows">删除行</button>
		<button id="delCols">删除列</button>
	</body>

</html>