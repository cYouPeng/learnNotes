<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>一级标题列表</title>
		<link rel="stylesheet" href="css/common.css" />
		<script type="text/javascript" src="../js/jquery-1.11.3.js"></script>
		<script type="text/javascript" src="../js/authorization.js"></script>
		<script type="text/javascript" src="../js/common.js"></script>
		<script>
			$(function(){
				var str = "";
				$.ajax({
		    		type:"post",
		        	url:"../ft/selectFirstTitleAll.do",
		        	success:function(data,stutas,xhr){
		        		for(i in data){
			        		str += "<tr>"+
								       "<td>"+data[i].fid+"</td>"+
									   "<td>"+data[i].titleName+"</td>"+
									   "<td>"+data[i].creator+"</td>"+
									   "<td>"+data[i].createTime+"</td>"+
									   "<td><a href='updateFirst.html?fid="+data[i].fid+"'>更新</a></td>"+
									   /*
									    * 删除不能使用超链接。	
									    * 原因：删除后是要回到本页面的。而a标签的href属性即使不写任何值，也会自动跳转回本页面。
									    *       这样就会自动再次执行本页面。此时有可能会出现连续的异步ajax请求，就有可能出现数据异常。
									    */
									   "<td><button onclick='del("+data[i].fid+")'>删除</button></td>"+
									"</tr>";
			        	}
		        		$("#dataList").append(str);
		        	},
		        	error:function(xhr,error){
		        		alert("请求失败！");
		        	}
				});
			});
			function del(fid){
				if(!window.confirm("你确认要删除它以及它的子记录吗？")){
					return false;
				}
				$.ajax({
		    		type:"post",
		        	url:"../ft/deleteFirstTitleById.do",
		        	data:{
		        		"fid":fid
		        	},
		        	success:function(data,stutas,xhr){
		        		if(data=="1"){
			        		window.location.href="firstList.html";
			        	}else{
			        		window.location.href="error.html";
			        	}
		        	},
		        	error:function(xhr,error){
		        		alert("请求失败！");
		        	}
				});
			}
		</script>
	</head>
	<body>
		<div class="container">
			<div class="box">
				<div class="title">
					<span>一级标题列表</span>
				</div>
				<div class="content">
					<table class="dataList">
						<tr>
							<th>一级标题ID</th>
							<th>一级标题名称</th>
							<th>创建者</th>
							<th>创建时间</th>
							<th>更新</th>
							<th>删除</th>
						</tr>
						<tbody id="dataList"></tbody>
						<tr>
							<td colspan="6"><a href="">上一页</a>&nbsp;|&nbsp;<a href="">下一页</a></td>
						</tr>
					</table>
				</div>
			</div>
		</div>
	</body>
</html>
